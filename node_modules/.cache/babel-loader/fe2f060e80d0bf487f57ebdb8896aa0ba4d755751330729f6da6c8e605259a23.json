{"ast":null,"code":"// File: src/context/EventContext.js\nimport React,{createContext,useContext,useState,useEffect}from'react';import{generateTemporaryToken,cleanupExpiredTokens}from'../utils/crypto';import{jsx as _jsx}from\"react/jsx-runtime\";const EventContext=/*#__PURE__*/createContext();export function EventProvider(_ref){let{children}=_ref;const[events,setEvents]=useState([]);const[userEvents,setUserEvents]=useState(new Set());// Stores event tokens\n// Load user's event tokens on mount\nuseEffect(()=>{const loadUserEvents=()=>{const tokens=new Set();for(let i=0;i<localStorage.length;i++){const key=localStorage.key(i);if(key.startsWith('event_')){try{const{token,expiration}=JSON.parse(localStorage.getItem(key));if(new Date(expiration)>new Date()){tokens.add(key.replace('event_',''));}}catch(e){// Invalid data, will be cleaned up\n}}}setUserEvents(tokens);};loadUserEvents();cleanupExpiredTokens();},[]);const createEvent=eventData=>{const newEvent={...eventData,id:generateTemporaryToken(),createdAt:new Date().toISOString(),participants:[],waitlist:[]};setEvents(prev=>[...prev,newEvent]);return newEvent;};const joinEvent=eventId=>{const event=events.find(e=>e.id===eventId);if(!event)return null;const token=generateTemporaryToken();const expiration=new Date();expiration.setDate(expiration.getDate()+1);localStorage.setItem(`event_${eventId}`,JSON.stringify({token,expiration:expiration.toISOString()}));setUserEvents(prev=>new Set([...prev,eventId]));return{token,expiration:expiration.toISOString()};};const leaveEvent=eventId=>{localStorage.removeItem(`event_${eventId}`);setUserEvents(prev=>{const newSet=new Set(prev);newSet.delete(eventId);return newSet;});};const isParticipant=eventId=>{return userEvents.has(eventId);};const value={events,createEvent,joinEvent,leaveEvent,isParticipant};return/*#__PURE__*/_jsx(EventContext.Provider,{value:value,children:children});}export function useEvents(){const context=useContext(EventContext);if(!context){throw new Error('useEvents must be used within an EventProvider');}return context;}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","generateTemporaryToken","cleanupExpiredTokens","jsx","_jsx","EventContext","EventProvider","_ref","children","events","setEvents","userEvents","setUserEvents","Set","loadUserEvents","tokens","i","localStorage","length","key","startsWith","token","expiration","JSON","parse","getItem","Date","add","replace","e","createEvent","eventData","newEvent","id","createdAt","toISOString","participants","waitlist","prev","joinEvent","eventId","event","find","setDate","getDate","setItem","stringify","leaveEvent","removeItem","newSet","delete","isParticipant","has","value","Provider","useEvents","context","Error"],"sources":["/home/elysia/dancingdragons/src/context/EventContext.js"],"sourcesContent":["// File: src/context/EventContext.js\n\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { generateTemporaryToken, cleanupExpiredTokens } from '../utils/crypto';\n\nconst EventContext = createContext();\n\nexport function EventProvider({ children }) {\n  const [events, setEvents] = useState([]);\n  const [userEvents, setUserEvents] = useState(new Set()); // Stores event tokens\n\n  // Load user's event tokens on mount\n  useEffect(() => {\n    const loadUserEvents = () => {\n      const tokens = new Set();\n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i);\n        if (key.startsWith('event_')) {\n          try {\n            const { token, expiration } = JSON.parse(localStorage.getItem(key));\n            if (new Date(expiration) > new Date()) {\n              tokens.add(key.replace('event_', ''));\n            }\n          } catch (e) {\n            // Invalid data, will be cleaned up\n          }\n        }\n      }\n      setUserEvents(tokens);\n    };\n\n    loadUserEvents();\n    cleanupExpiredTokens();\n  }, []);\n\n  const createEvent = (eventData) => {\n    const newEvent = {\n      ...eventData,\n      id: generateTemporaryToken(),\n      createdAt: new Date().toISOString(),\n      participants: [],\n      waitlist: []\n    };\n\n    setEvents(prev => [...prev, newEvent]);\n    return newEvent;\n  };\n\n  const joinEvent = (eventId) => {\n    const event = events.find(e => e.id === eventId);\n    if (!event) return null;\n\n    const token = generateTemporaryToken();\n    const expiration = new Date();\n    expiration.setDate(expiration.getDate() + 1);\n\n    localStorage.setItem(`event_${eventId}`, JSON.stringify({\n      token,\n      expiration: expiration.toISOString()\n    }));\n\n    setUserEvents(prev => new Set([...prev, eventId]));\n    \n    return {\n      token,\n      expiration: expiration.toISOString()\n    };\n  };\n\n  const leaveEvent = (eventId) => {\n    localStorage.removeItem(`event_${eventId}`);\n    setUserEvents(prev => {\n      const newSet = new Set(prev);\n      newSet.delete(eventId);\n      return newSet;\n    });\n  };\n\n  const isParticipant = (eventId) => {\n    return userEvents.has(eventId);\n  };\n\n  const value = {\n    events,\n    createEvent,\n    joinEvent,\n    leaveEvent,\n    isParticipant\n  };\n\n  return (\n    <EventContext.Provider value={value}>\n      {children}\n    </EventContext.Provider>\n  );\n}\n\nexport function useEvents() {\n  const context = useContext(EventContext);\n  if (!context) {\n    throw new Error('useEvents must be used within an EventProvider');\n  }\n  return context;\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}